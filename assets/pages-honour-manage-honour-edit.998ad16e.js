import{k as e,L as l,am as a,m as o,q as t,D as r,an as u,o as s,b as d,a as n,w as m,x as i,Y as c,y as f,t as p,f as _,e as v,F as y,B as b,C as g,h,Z as V}from"./index.7dddb93e.js";import{_ as x}from"./u-navbar.2247389e.js";import{_ as w}from"./message.vue_vue_type_script_setup_true_lang.167ae55e.js";import{_ as j}from"./u-input.4a92a7e0.js";import{_ as k,a as C}from"./u-form.2758243d.js";import{_ as U,a as A}from"./u-cell-group.3ff6fc80.js";import{_ as N}from"./u-picker.e822a654.js";import{_ as T}from"./u-button.7f757efe.js";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang.53873a0c.js";import{_ as F,d as L}from"./useDebounce.1587bee8.js";import{a as O,b as R}from"./Honour.bb0d5fc3.js";import{g as E}from"./go.59004091.js";import{_ as H}from"./_plugin-vue_export-helper.cdc0426e.js";import"./emitter.9c2dba95.js";import"./u-upload.fc59abfe.js";import"./u-line-progress.c40d9c0e.js";const z=H(e({__name:"edit",setup(e){const H=l(),z=a(),D=o(!1),I=o(!1),S=o(!1),q=o(""),Y=o(""),Z=o([]),G=o();let J=o([]),K=o([]),M=o({awardUnit:"",code:"",fileAddress:[],fileName:"",fileNumber:"",gloryAddress:[],gloryName:"",gloryTime:"",honoree:"",partyCommitteeCode:"",partyBranchCode:""});t((async e=>{if(e&&e.code){let l=await O({code:e.code});q.value=l.partyCommitteeName,Y.value=l.partyBranchName,Object.keys(l).filter((e=>Object.keys(M.value).includes(e))).reduce(((e,a)=>(e[a]=l[a],e)),M.value),M.value.gloryAddress.forEach((e=>{J.value.push({url:r.ResourceUrl+e.url})})),M.value.fileAddress.forEach((e=>{let l=e.url.split("bucket/").pop();K.value.push({url:r.ResourceUrl+l,name:e.name})}));let a=await u({code:l.partyCommitteeCode});Z.value=a}}));const P=e=>{M.value.gloryAddress.push({name:e.split("/")[1],url:e})},Q=e=>{M.value.gloryTime=e.year+"-"+e.month+"-"+e.day},W=()=>{G.value.uploadFile()},X=e=>{M.value.fileAddress.push(e)},$=async e=>{q.value=z.committeeList[e[0]].name,M.value.partyCommitteeCode=z.committeeList[e[0]].code,Y.value="";let l=await u({code:z.committeeList[e[0]].code});Z.value=l},ee=e=>{Y.value=Z.value[e[0]].name,M.value.partyBranchCode=Z.value[e[0]].code},le=e=>{M.value.gloryAddress.splice(e,1)},ae=L((async()=>{let e=oe(M.value);console.log(e);for(const[a,o]of Object.entries(M.value))if("partyBranchCode"!==a&&"code"!==a){if(console.log(M.value),e){await R(M.value);try{H.showTips({title:"修改成功",type:"success"}),setTimeout((()=>{E("/pages/honour-manage/honour/honour"),V("addHonourSuccess")}),1e3)}catch(l){}break}H.showTips({title:"请将内容填写完整",type:"warning"});break}}),1e3),oe=e=>{for(const[l,a]of Object.entries(e))if("partyBranchCode"!==l&&"code"!==l&&(""===a||Array.isArray(a)&&0===a.length||void 0===a))return!1;return!0},te=e=>{M.value.fileAddress.forEach(((l,a)=>{l.name==e.name&&M.value.fileAddress.splice(a,1)}))};return(e,l)=>{const a=b(g("u-navbar"),x),o=b(g("message"),w),t=b(g("u-input"),j),r=b(g("u-form-item"),k),u=b(g("u-form"),C),V=h,L=b(g("u-cell-item"),U),O=b(g("u-cell-group"),A),R=b(g("u-picker"),N),E=b(g("u-button"),T);return s(),d(y,null,[n(a,{"title-color":"#000","is-back":!0,title:"修改荣誉",background:{background:"#ffffff"},"border-bottom":!1}),n(o,{navbarHeight:48}),n(V,{class:"container pb-20rpx"},{default:m((()=>[n(u,{clas:"p-4px",model:i(M),"label-width":"200",ref:"uForm","label-align":"center"},{default:m((()=>[n(r,{label:"荣誉名称"},{default:m((()=>[n(t,{modelValue:i(M).gloryName,"onUpdate:modelValue":l[0]||(l[0]=e=>i(M).gloryName=e),placeholder:"请输入荣誉名称"},null,8,["modelValue"])])),_:1}),n(r,{label:"获奖对象"},{default:m((()=>[n(t,{modelValue:i(M).honoree,"onUpdate:modelValue":l[1]||(l[1]=e=>i(M).honoree=e),placeholder:"请输入获奖对象"},null,8,["modelValue"])])),_:1}),n(r,{label:"颁奖单位"},{default:m((()=>[n(t,{modelValue:i(M).awardUnit,"onUpdate:modelValue":l[2]||(l[2]=e=>i(M).awardUnit=e),placeholder:"请输入颁奖单位"},null,8,["modelValue"])])),_:1}),n(r,{label:"获奖文件名称"},{default:m((()=>[n(t,{modelValue:i(M).fileName,"onUpdate:modelValue":l[3]||(l[3]=e=>i(M).fileName=e),placeholder:"请输入获奖文件名称"},null,8,["modelValue"])])),_:1}),n(r,{label:"获奖文件号"},{default:m((()=>[n(t,{modelValue:i(M).fileNumber,"onUpdate:modelValue":l[4]||(l[4]=e=>i(M).fileNumber=e),placeholder:"请输入获奖文件号"},null,8,["modelValue"])])),_:1}),n(r,{label:"二级党委"},{default:m((()=>[n(t,{placeholder:"请选择二级党委",disabled:!0,onClick:l[5]||(l[5]=e=>I.value=!0),modelValue:i(q),"onUpdate:modelValue":l[6]||(l[6]=e=>c(q)?q.value=e:null)},null,8,["modelValue"])])),_:1}),n(r,{label:"党支部"},{default:m((()=>[n(t,{placeholder:"请选择党支部",disabled:!0,onClick:l[7]||(l[7]=e=>S.value=!0),modelValue:i(Y),"onUpdate:modelValue":l[8]||(l[8]=e=>c(Y)?Y.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),n(O,null,{default:m((()=>[n(L,{arrow:!1},{default:m((()=>[n(V,{slot:"icon",class:"flex items-center"},{default:m((()=>[f("span",null,"获奖时间"),n(V,{class:"flex flex-col items-center justify-center my-20rpx"},{default:m((()=>[n(V,{class:"w-350rpx h-50rpx m-20rpx rounded-lg bg--wn-f5f5f5 leading-50rpx text-center mx-20rpx",onClick:l[9]||(l[9]=e=>D.value=!0)},{default:m((()=>[""==i(M).gloryTime?(s(),d("span",{key:0}," 开始时间 ")):(s(),d("span",{key:1,class:"v-else"},p(i(M).gloryTime),1))])),_:1})])),_:1})])),_:1})])),_:1}),n(L,{arrow:!1},{default:m((()=>[n(V,{slot:"icon",class:"flex items-center"},{default:m((()=>[n(V,{class:"justify-center w-full"},{default:m((()=>[n(V,{class:"w-224rpx"},{default:m((()=>[_(" 荣誉证书上传 ")])),_:1}),n(V,{class:"w-700rpx"},{default:m((()=>[n(F,{"file-list":i(J),onUploadSuccess:P,onImgRemove:le},null,8,["file-list"])])),_:1})])),_:1})])),_:1})])),_:1}),n(L,{arrow:!1,onClick:v(W,["self"])},{default:m((()=>[n(V,{slot:"icon",class:"flex items-center"},{default:m((()=>[n(V,{class:"justify-center w-full"},{default:m((()=>[n(V,{class:"w-224rpx"},{default:m((()=>[_(" 获奖文件上传 ")])),_:1}),n(V,{class:"w-700rpx"},{default:m((()=>[n(B,{ref_key:"fileupload",ref:G,onFileUploadFinsh:X,onRemoveFile:te,"props-list":i(K)},null,8,["props-list"])])),_:1})])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),n(R,{modelValue:i(D),"onUpdate:modelValue":l[10]||(l[10]=e=>c(D)?D.value=e:null),mode:"time",params:{year:!0,month:!0,day:!0},onConfirm:Q},null,8,["modelValue"]),n(R,{mode:"selector",modelValue:i(I),"onUpdate:modelValue":l[11]||(l[11]=e=>c(I)?I.value=e:null),range:i(z).committeeList,"z-index":"99999999999999",title:"请选择二级党委","default-selector":[0],"range-key":"name",onConfirm:$},null,8,["modelValue","range"]),n(R,{mode:"selector",modelValue:i(S),"onUpdate:modelValue":l[12]||(l[12]=e=>c(S)?S.value=e:null),range:i(Z),"z-index":"99999999999999",title:"请选择党支部","default-selector":[0],"range-key":"name",onConfirm:ee},null,8,["modelValue","range"]),n(V,{class:"flex items-center justify-around w-full h-300rpx"},{default:m((()=>[n(E,{class:"w-95-pes-",type:"primary",ripple:!0,onClick:l[13]||(l[13]=e=>i(ae)())},{default:m((()=>[_("提交")])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-c1cd83b5"]]);export{z as default};
