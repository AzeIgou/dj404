import{k as a,L as e,T as s,m as l,q as r,o as t,b as o,a as i,w as u,f as n,t as p,x as m,F as d,D as f,H as c,Z as b,B as v,C as g,h as _}from"./index.f8f0a8a6.js";import{_ as y}from"./u-navbar.1284843c.js";import{_ as h}from"./message.vue_vue_type_script_setup_true_lang.2049d432.js";import{_ as w,a as j}from"./u-cell-group.c1b9a19e.js";import{_ as x}from"./u-upload.bcce9b3d.js";import{_ as A}from"./u-button.9b5620aa.js";import{d as Y}from"./dayjs.min.4485b413.js";import{v as D,s as T}from"./formal-apply.ad717eb9.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./u-line-progress.aa9a4d7b.js";const U=a({__name:"submit",setup(a){const U=e(),S=s(),k=[],M=l(null),R=l({}),I=l([]),O=l(),B=l(!1);r((async a=>{var e;a&&a.type&&(O.value=a.type);const s=await D({username:null==(e=S.userInfo)?void 0:e.username});R.value=s,"edit"==O.value&&(I.value=s.formalApplyAddress)}));const C=(a,e,s)=>{const{data:{imageUrl:l}}=a;k.push(l)},E=(a,e,s)=>{const l=e.filter((a=>100==a.progress));I.value=l.map((a=>a.url.slice(f.ResourceUrl.length)))},H=async()=>{var a;try{B.value=!0;const e=[...I.value,...k];if(!e||!e.length)throw U.showTips({title:"提交内容不能为空",type:"error"}),Error("提交内容不能为空");await T({isSave:!0,formalApplyAddress:e,formalApplyDate:Y().format("YYYY-MM-DD"),username:null==(a=S.userInfo)?void 0:a.username}),U.showTips({title:"提交成功",type:"success"}),setTimeout((()=>{c()}),500),b("refresh")}catch{B.value=!1}};return(a,e)=>{const s=v(g("u-navbar"),y),l=v(g("message"),h),r=v(g("u-cell-item"),w),c=v(g("u-upload"),x),b=v(g("u-cell-group"),j),D=_,T=v(g("u-button"),A);return t(),o(d,null,[i(s,{title:"提交转正申请"}),i(l,{navbarHeight:48}),i(D,{class:"container"},{default:u((()=>[i(b,null,{default:u((()=>[i(r,{title:"转正申请有效日期",arrow:!1},{"right-icon":u((()=>[n(p(m(R).formalApplyBeginDate)+"-"+p(m(R).formalApplyEndTime),1)])),_:1}),i(r,{title:"提交日期",arrow:!1},{"right-icon":u((()=>[n(p(m(Y)().format("YYYY-MM-DD")),1)])),_:1}),i(r,{title:"转正申请",arrow:!1},{label:u((()=>[i(c,{ref_key:"uploadRef",ref:M,name:"image",action:m(f).UploadImgUrl,"auto-upload":!1,header:{Authorization:m(S).token},"file-list":m(I).map((a=>({url:m(f).ResourceUrl+a}))),onOnSuccess:C,onOnRemove:E,onOnUploaded:H},null,8,["action","header","file-list"])])),_:1})])),_:1})])),_:1}),i(D,{class:"fixed flex justify-between gap-5 bottom-0 p-5 w-full bg-white rounded-t-lg",style:{"box-shadow":"0px 2px 15px 0px rgba(184, 184, 210, 0.5)"}},{default:u((()=>{var a,s;return[i(T,{class:"flex-1",type:"primary",onClick:e[0]||(e[0]=a=>m(M).upload()),loading:m(B),disabled:!("add"==m(O)&&(null==(a=m(R))?void 0:a.isSubmissionTime)&&!m(R).isSubmission||"edit"==m(O)&&(null==(s=m(R))?void 0:s.isSubmissionTime))},{default:u((()=>[n("提交")])),_:1},8,["loading","disabled"])]})),_:1})],64)}}});export{U as default};
