import{k as s,T as e,L as a,m as r,M as l,q as o,o as t,b as u,a as i,w as n,x as d,f as m,Y as p,F as c,D as f,Z as _,H as y,B as g,C as h,h as v}from"./index.7dddb93e.js";import{_ as j}from"./u-navbar.2247389e.js";import{_ as b}from"./message.vue_vue_type_script_setup_true_lang.167ae55e.js";import{_ as w,a as P}from"./u-cell-group.3ff6fc80.js";import{_ as A}from"./u-switch.a28c9770.js";import{_ as T}from"./u-upload.fc59abfe.js";import{_ as Y}from"./u-button.7f757efe.js";import{_ as U}from"./u-calendar.4c7fa535.js";import{b as x}from"./develop.f2386993.js";import{d as V}from"./dayjs.min.4485b413.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./u-line-progress.c40d9c0e.js";const k=s({__name:"ys-upload",setup(s){const k=e(),D=a(),M=[],z=r(null),C=r(!1),O=r(!1),R=l({username:"",isPass:!0,ysAddress:[],yspassTime:V().format("YYYY-MM-DD")});o((s=>{s&&s.ysAddress&&(R.ysAddress=JSON.parse(s.ysAddress)),s&&s.username&&(R.username=s.username),s&&s.isPass&&(1==s.isPass?R.isPass=!0:2==s.isPass&&(R.isPass=!1))}));const H=(s,e,a)=>{const{data:{imageUrl:r}}=s;M.push(r)},S=(s,e,a)=>{const r=e.filter((s=>100==s.progress));R.ysAddress=r.map((s=>s.url.slice(f.ResourceUrl.length)))},q=async()=>{try{O.value=!0;const s=[...R.ysAddress,...M];if(!s||!s.length)throw D.showTips({title:"提交内容不能为空",type:"error"}),Error("提交内容不能为空");await x({isPass:R.isPass,username:R.username,zsAddress:s,zspassTime:R.yspassTime}),D.showTips({title:"上传成功"}),_("refresh"),setTimeout((()=>y()),500)}catch(s){O.value=!1}};return(s,e)=>{const a=g(h("u-navbar"),j),r=g(h("message"),b),l=g(h("u-cell-item"),w),o=g(h("u-switch"),A),_=g(h("u-upload"),T),y=g(h("u-cell-group"),P),x=g(h("u-button"),Y),D=v,M=g(h("u-calendar"),U);return t(),u(c,null,[i(a,{title:"上传预审表"}),i(r,{navbarHeight:48}),i(D,{class:"container"},{default:n((()=>[i(y,null,{default:n((()=>[i(l,{title:"预审日期",arrow:!1,value:d(R).yspassTime,onClick:e[0]||(e[0]=s=>C.value=!0)},null,8,["value"]),i(l,{title:"预审状态",arrow:!1},{"right-icon":n((()=>[i(o,{modelValue:d(R).isPass,"onUpdate:modelValue":e[1]||(e[1]=s=>d(R).isPass=s),size:"40"},null,8,["modelValue"])])),_:1}),i(l,{title:"上传预审表",arrow:!1},{label:n((()=>[i(_,{ref_key:"uploadRef",ref:z,name:"image",action:d(f).UploadImgUrl,"auto-upload":!1,header:{Authorization:d(k).token},"file-list":d(R).ysAddress.map((s=>({url:d(f).ResourceUrl+s}))),onOnSuccess:H,onOnRemove:S,onOnUploaded:q},null,8,["action","header","file-list"])])),_:1})])),_:1}),i(D,{class:"fixed bottom-0 w-full"},{default:n((()=>[i(x,{loading:d(O),type:"primary",onClick:e[2]||(e[2]=s=>d(z).upload())},{default:n((()=>[m("上传")])),_:1},8,["loading"])])),_:1})])),_:1}),i(M,{modelValue:d(C),"onUpdate:modelValue":e[3]||(e[3]=s=>p(C)?C.value=s:null),onChange:e[4]||(e[4]=s=>d(R).yspassTime=s.result),"max-date":d(V)().add(1,"y").format("YYYY-MM-DD")},null,8,["modelValue","max-date"])],64)}}});export{k as default};
