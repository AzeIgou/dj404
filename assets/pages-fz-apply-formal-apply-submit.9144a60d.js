import{k as e,L as a,T as s,m as l,q as r,o as t,b as o,a as i,w as u,f as n,t as p,x as m,F as d,D as f,H as c,Z as v,B as g,C as _,h as b}from"./index.7dddb93e.js";import{_ as y}from"./u-navbar.2247389e.js";import{_ as h}from"./message.vue_vue_type_script_setup_true_lang.167ae55e.js";import{_ as w,a as j}from"./u-cell-group.3ff6fc80.js";import{_ as x}from"./u-upload.fc59abfe.js";import{_ as A}from"./u-button.7f757efe.js";import{d as Y}from"./dayjs.min.4485b413.js";import{v as D,s as T}from"./formal-apply.22f29fa9.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./u-line-progress.c40d9c0e.js";const U=e({__name:"submit",setup(e){const U=a(),S=s(),k=[],M=l(null),R=l({}),I=l([]),O=l(),B=l(!1);r((async e=>{var a;e&&e.type&&(O.value=e.type);const s=await D({username:null==(a=S.userInfo)?void 0:a.username});R.value=s,"edit"==O.value&&(I.value=s.formalApplyAddress)}));const C=(e,a,s)=>{const{data:{imageUrl:l}}=e;k.push(l)},E=(e,a,s)=>{const l=a.filter((e=>100==e.progress));I.value=l.map((e=>e.url.slice(f.ResourceUrl.length)))},H=async()=>{var e;try{B.value=!0;const a=[...I.value,...k];if(!a||!a.length)throw U.showTips({title:"提交内容不能为空",type:"error"}),Error("提交内容不能为空");await T({isSave:!0,formalApplyAddress:a,formalApplyDate:Y().format("YYYY-MM-DD"),username:null==(e=S.userInfo)?void 0:e.username}),U.showTips({title:"提交成功",type:"success"}),setTimeout((()=>{c()}),500),v("refresh")}catch{B.value=!1}};return(e,a)=>{const s=g(_("u-navbar"),y),l=g(_("message"),h),r=g(_("u-cell-item"),w),c=g(_("u-upload"),x),v=g(_("u-cell-group"),j),D=b,T=g(_("u-button"),A);return t(),o(d,null,[i(s,{title:"提交转正申请"}),i(l,{navbarHeight:48}),i(D,{class:"container"},{default:u((()=>[i(v,null,{default:u((()=>[i(r,{title:"转正申请有效日期",arrow:!1},{"right-icon":u((()=>[n(p(m(R).formalApplyBeginDate)+"-"+p(m(R).formalApplyEndTime),1)])),_:1}),i(r,{title:"提交日期",arrow:!1},{"right-icon":u((()=>[n(p(m(Y)().format("YYYY-MM-DD")),1)])),_:1}),i(r,{title:"转正申请",arrow:!1},{label:u((()=>[i(c,{ref_key:"uploadRef",ref:M,name:"image",action:m(f).UploadImgUrl,"auto-upload":!1,header:{Authorization:m(S).token},"file-list":m(I).map((e=>({url:m(f).ResourceUrl+e}))),onOnSuccess:C,onOnRemove:E,onOnUploaded:H},null,8,["action","header","file-list"])])),_:1})])),_:1})])),_:1}),i(D,{class:"fixed flex justify-between gap-5 bottom-0 p-5 w-full bg-white rounded-t-lg",style:{"box-shadow":"0px 2px 15px 0px rgba(184, 184, 210, 0.5)"}},{default:u((()=>{var e,s;return[i(T,{class:"flex-1",type:"primary",onClick:a[0]||(a[0]=e=>m(M).upload()),loading:m(B),disabled:!("add"==m(O)&&(null==(e=m(R))?void 0:e.isSubmissionTime)&&!m(R).isSubmission||"edit"==m(O)&&(null==(s=m(R))?void 0:s.isSubmissionTime))},{default:u((()=>[n("提交")])),_:1},8,["loading","disabled"])]})),_:1})],64)}}});export{U as default};
