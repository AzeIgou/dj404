import{k as e,T as s,L as a,m as r,q as t,o,b as l,a as u,w as i,x as n,f as p,F as m,D as d,Z as c,H as f,B as _,C as g,h as v}from"./index.7dddb93e.js";import{_ as h}from"./u-navbar.2247389e.js";import{_ as b}from"./message.vue_vue_type_script_setup_true_lang.167ae55e.js";import{_ as j}from"./u-upload.fc59abfe.js";import{_ as y,a as w}from"./u-cell-group.3ff6fc80.js";import{_ as z}from"./u-button.7f757efe.js";import{s as U}from"./develop.f2386993.js";import{d as x}from"./dayjs.min.4485b413.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./u-line-progress.c40d9c0e.js";const T=e({__name:"zs-upload",setup(e){const T=s(),k=a(),A=[],O=r(null),R=r(""),Y=r([]),D=r(!1);t((e=>{e&&e.zsAddress&&(Y.value=JSON.parse(e.zsAddress)),e&&e.username&&(R.value=e.username)}));const C=(e,s,a)=>{const{data:{imageUrl:r}}=e;A.push(r)},H=(e,s,a)=>{const r=s.filter((e=>100==e.progress));Y.value=r.map((e=>e.url.slice(d.ResourceUrl.length)))},M=async()=>{try{D.value=!0;const e=[...Y.value,...A];if(!e||!e.length)throw k.showTips({title:"提交内容不能为空",type:"error"}),Error("提交内容不能为空");await U({isPass:!0,username:R.value,zsAddress:e,zspassTime:x().format("YYYY-MM-DD")}),k.showTips({title:"上传成功",type:"success"}),c("refresh"),setTimeout((()=>f()),500)}catch(e){D.value=!1}};return(e,s)=>{const a=_(g("u-navbar"),h),r=_(g("message"),b),t=_(g("u-upload"),j),c=_(g("u-cell-item"),y),f=_(g("u-cell-group"),w),U=_(g("u-button"),z),x=v;return o(),l(m,null,[u(a,{title:"上传政审表"}),u(r,{navbarHeight:48}),u(x,{class:"container"},{default:i((()=>[u(f,null,{default:i((()=>[u(c,{title:"上传政审表",arrow:!1},{label:i((()=>[u(t,{ref_key:"uploadRef",ref:O,name:"image",action:n(d).UploadImgUrl,"auto-upload":!1,header:{Authorization:n(T).token},"file-list":n(Y).map((e=>({url:n(d).ResourceUrl+e}))),onOnSuccess:C,onOnRemove:H,onOnUploaded:M},null,8,["action","header","file-list"])])),_:1})])),_:1}),u(x,{class:"fixed bottom-0 w-full"},{default:i((()=>[u(U,{loading:n(D),type:"primary",onClick:s[0]||(s[0]=e=>n(O).upload())},{default:i((()=>[p("上传")])),_:1},8,["loading"])])),_:1})])),_:1})],64)}}});export{T as default};
