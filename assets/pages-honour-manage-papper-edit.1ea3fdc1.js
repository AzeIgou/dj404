import{k as e,L as a,am as l,m as o,q as t,an as r,D as u,o as s,b as d,a as m,w as n,x as i,Y as c,y as p,t as f,f as v,F as _,B as b,C as y,h as g,Z as V}from"./index.f8f0a8a6.js";import{_ as h}from"./u-navbar.1284843c.js";import{_ as j}from"./message.vue_vue_type_script_setup_true_lang.2049d432.js";import{_ as x}from"./u-input.f5a1625f.js";import{_ as C,a as k}from"./u-form.86e30c0a.js";import{_ as w,a as U}from"./u-cell-group.c1b9a19e.js";import{_ as T}from"./u-picker.4f0ca51a.js";import{_ as A}from"./u-button.9b5620aa.js";import{_ as N,d as B}from"./useDebounce.704380c3.js";import{p as P}from"./index.14235ccc.js";import{g as L}from"./go.241c4b18.js";import{e as O,b as z}from"./papper.6dea8f74.js";import{_ as W}from"./_plugin-vue_export-helper.cdc0426e.js";import"./emitter.9c2dba95.js";import"./u-upload.bcce9b3d.js";import"./u-line-progress.aa9a4d7b.js";const D=W(e({__name:"edit",setup(e){const W=a(),D=l(),F=o(!1),I=o(!1),R=o(!1),S=o(!1),q=o(""),E=o("");let H=o([]);const Y=o([]);let Z=o({code:"",paperName:"",PaperTime:"",mainWriter:"",level:"",journalName:"",partyCommitteeCode:"",partyBranchCode:"",fileAddress:[]});t((async e=>{if(e&&e.code){let a=await O({code:e.code});Z.value.PaperTime=a.paperTime,q.value=a.partyCommitteeName,E.value=a.partyBranchName,Object.keys(a).filter((e=>Object.keys(Z.value).includes(e))).reduce(((e,l)=>(e[l]=a[l],e)),Z.value);let l=await r({code:a.partyCommitteeCode});Y.value=l}Z.value.fileAddress.forEach((e=>{H.value.push({url:u.ResourceUrl+e.url})}))}));const G=e=>{Z.value.fileAddress.push({name:e.split("/")[1],url:e})},J=e=>{Z.value.PaperTime=e.year+"-"+e.month+"-"+e.day},K=async e=>{q.value=D.committeeList[e[0]].name,Z.value.partyCommitteeCode=D.committeeList[e[0]].code,E.value="";let a=await r({code:D.committeeList[e[0]].code});Y.value=a},M=e=>{E.value=Y.value[e[0]].name,Z.value.partyBranchCode=Y.value[e[0]].code},Q=e=>{Z.value.fileAddress.splice(e,1)},X=e=>{Z.value.level=P[e[0]].value},$=B((async()=>{let e=ee(Z.value);console.log(e);for(const[l,o]of Object.entries(Z.value))if("partyBranchCode"!==l&&"code"!==l&&"fileAddress"!==l){if(e){await z(Z.value);try{W.showTips({title:"修改成功",type:"success"}),setTimeout((()=>{L("/pages/honour-manage/papper/papper"),V("addPapperSuccess")}),1e3)}catch(a){}break}W.showTips({title:"请将内容填写完整",type:"warning"});break}}),1e3),ee=e=>{for(const[a,l]of Object.entries(e))if("partyBranchCode"!==a&&"code"!==a&&"fileAddress"!==a&&(""===l||Array.isArray(l)&&0===l.length||void 0===l))return!1;return!0};return(e,a)=>{const l=b(y("u-navbar"),h),o=b(y("message"),j),t=b(y("u-input"),x),r=b(y("u-form-item"),C),u=b(y("u-form"),k),V=g,B=b(y("u-cell-item"),w),L=b(y("u-cell-group"),U),O=b(y("u-picker"),T),z=b(y("u-button"),A);return s(),d(_,null,[m(l,{"title-color":"#000","is-back":!0,title:"修改论文",background:{background:"#ffffff"},"border-bottom":!1}),m(o,{navbarHeight:48}),m(V,{class:"container pb-20rpx"},{default:n((()=>[m(u,{clas:"p-4px",model:i(Z),"label-width":"200",ref:"uForm","label-align":"center"},{default:n((()=>[m(r,{label:"论文名称"},{default:n((()=>[m(t,{modelValue:i(Z).paperName,"onUpdate:modelValue":a[0]||(a[0]=e=>i(Z).paperName=e),placeholder:"请输入荣誉名称"},null,8,["modelValue"])])),_:1}),m(r,{label:"第一作者"},{default:n((()=>[m(t,{modelValue:i(Z).mainWriter,"onUpdate:modelValue":a[1]||(a[1]=e=>i(Z).mainWriter=e),placeholder:"请输入获奖对象"},null,8,["modelValue"])])),_:1}),m(r,{label:"期刊名称"},{default:n((()=>[m(t,{modelValue:i(Z).journalName,"onUpdate:modelValue":a[2]||(a[2]=e=>i(Z).journalName=e),placeholder:"请输入颁奖单位"},null,8,["modelValue"])])),_:1}),m(r,{label:"二级党委"},{default:n((()=>[m(t,{placeholder:"请选择二级党委",disabled:!0,onClick:a[3]||(a[3]=e=>I.value=!0),modelValue:i(q),"onUpdate:modelValue":a[4]||(a[4]=e=>c(q)?q.value=e:null)},null,8,["modelValue"])])),_:1}),m(r,{label:"党支部"},{default:n((()=>[m(t,{placeholder:"请选择党支部",disabled:!0,onClick:a[5]||(a[5]=e=>S.value=!0),modelValue:i(E),"onUpdate:modelValue":a[6]||(a[6]=e=>c(E)?E.value=e:null)},null,8,["modelValue"])])),_:1}),m(r,{label:"论文级别"},{default:n((()=>[m(t,{placeholder:"请选择论文级别",disabled:!0,onClick:a[7]||(a[7]=e=>R.value=!0),modelValue:i(Z).level,"onUpdate:modelValue":a[8]||(a[8]=e=>i(Z).level=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),m(L,null,{default:n((()=>[m(B,{arrow:!1},{default:n((()=>[m(V,{slot:"icon",class:"flex items-center"},{default:n((()=>[p("span",null,"发表日期"),m(V,{class:"flex flex-col items-center justify-center my-20rpx"},{default:n((()=>[m(V,{class:"w-350rpx h-50rpx m-20rpx rounded-lg bg--wn-f5f5f5 leading-50rpx text-center mx-20rpx",onClick:a[9]||(a[9]=e=>F.value=!0)},{default:n((()=>[""==i(Z).PaperTime?(s(),d("span",{key:0}," 发表日期 ")):(s(),d("span",{key:1,class:"v-else"},f(i(Z).PaperTime),1))])),_:1})])),_:1})])),_:1})])),_:1}),m(B,{arrow:!1},{default:n((()=>[m(V,{slot:"icon",class:"flex items-center"},{default:n((()=>[m(V,{class:"justify-center w-full"},{default:n((()=>[m(V,{class:"w-224rpx"},{default:n((()=>[v(" 支撑材料上传 ")])),_:1}),m(V,{class:"w-700rpx"},{default:n((()=>[m(N,{"file-list":i(H),onUploadSuccess:G,onImgRemove:Q},null,8,["file-list"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),m(O,{modelValue:i(F),"onUpdate:modelValue":a[10]||(a[10]=e=>c(F)?F.value=e:null),mode:"time",params:{year:!0,month:!0,day:!0},onConfirm:J},null,8,["modelValue"]),m(O,{mode:"selector",modelValue:i(R),"onUpdate:modelValue":a[11]||(a[11]=e=>c(R)?R.value=e:null),range:i(P),"z-index":"99999999999999",title:"请选择论文级别","default-selector":[0],"range-key":"value",onConfirm:X},null,8,["modelValue","range"]),m(O,{mode:"selector",modelValue:i(I),"onUpdate:modelValue":a[12]||(a[12]=e=>c(I)?I.value=e:null),range:i(D).committeeList,"z-index":"99999999999999",title:"请选择二级党委","default-selector":[0],"range-key":"name",onConfirm:K},null,8,["modelValue","range"]),m(O,{mode:"selector",modelValue:i(S),"onUpdate:modelValue":a[13]||(a[13]=e=>c(S)?S.value=e:null),range:i(Y),"z-index":"99999999999999",title:"请选择党支部","default-selector":[0],"range-key":"name",onConfirm:M},null,8,["modelValue","range"]),m(V,{class:"flex items-center justify-around w-full h-300rpx"},{default:n((()=>[m(z,{class:"w-95-pes-",type:"primary",ripple:!0,onClick:a[14]||(a[14]=e=>i($)())},{default:n((()=>[v("提交")])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-b66e6eee"]]);export{D as default};
