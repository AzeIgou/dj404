import{o as e,c as t,w as l,a as s,n as a,I as i,d as o,h as r,k as u,a4 as d,x as n,L as c,m as h,a0 as v,aw as m,ax as p,a5 as f,B as g,C as y,e as b,Y as w,f as C,t as x,J as _,i as k,aq as P,G as S,ay as V,g as T,az as I,q as F,av as $,b as B,F as D,r as j,D as M,Z as W}from"./index.7dddb93e.js";import{_ as N}from"./u-navbar.2247389e.js";import{a as z,_ as R}from"./message.vue_vue_type_script_setup_true_lang.167ae55e.js";import{_ as X}from"./_plugin-vue_export-helper.cdc0426e.js";import{d as E}from"./dayjs.min.4485b413.js";import{_ as L}from"./u-section.0d3c8435.js";import{b as U,u as q}from"./study.882a7b91.js";import"./JSEncrypt.1622f795.js";const A=X({name:"u-slider",emits:["update:modelValue","input","start","moving","end"],props:{value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},disabled:{type:Boolean,default:!1},blockWidth:{type:[Number,String],default:30},min:{type:[Number,String],default:0},max:{type:[Number,String],default:100},step:{type:[Number,String],default:1},height:{type:[Number,String],default:6},activeColor:{type:String,default:"#2979ff"},inactiveColor:{type:String,default:"#c0c4cc"},blockColor:{type:String,default:"#ffffff"},blockStyle:{type:Object,default:()=>({})}},data:()=>({startX:0,status:"end",newValue:0,distanceX:0,startValue:0,barStyle:{},sliderRect:{left:0,width:0}}),watch:{valueCom(e){"end"==this.status&&this.updateValue(this.valueCom,!1)}},created(){this.updateValue(this.valueCom,!1)},mounted(){this.$uGetRect(".u-slider").then((e=>{this.sliderRect=e}))},computed:{valueCom(){return this.modelValue}},methods:{onTouchStart(e){if(this.disabled)return;this.startX=0;let t=e.touches[0];this.startX=t.clientX,this.startValue=this.format(this.valueCom),this.status="start"},onTouchMove(e){if(this.disabled)return;"start"==this.status&&this.$emit("start");let t=e.touches[0];this.distanceX=t.clientX-this.sliderRect.left,this.newValue=this.distanceX/this.sliderRect.width*100,this.status="moving",this.$emit("moving"),this.updateValue(this.newValue,!0)},onTouchEnd(){this.disabled||("moving"===this.status&&(this.updateValue(this.newValue,!1),this.$emit("end")),this.status="end")},updateValue(e,t){const l=this.format(e);if(l>this.max||l>100)return;let s={width:l+"%"};1==t?s.transition="none":delete s.transition,this.$emit("input",l),this.$emit("update:modelValue",l),this.barStyle=s},format(e){return Math.round(Math.max(this.min,Math.min(e,this.max))/this.step)*this.step},onClick(e){if(this.disabled)return;const t=(e.detail.x-this.sliderRect.left)/this.sliderRect.width*100;this.updateValue(t,!1)}}},[["render",function(u,d,n,c,h,v){const m=r;return e(),t(m,{class:o(["u-slider",[n.disabled?"u-slider--disabled":""]]),onClick:v.onClick,style:a({backgroundColor:n.inactiveColor})},{default:l((()=>[s(m,{class:"u-slider__gap",style:a([h.barStyle,{height:n.height+"rpx",backgroundColor:n.activeColor}])},{default:l((()=>[s(m,{class:"u-slider__button-wrap",onTouchstart:v.onTouchStart,onTouchmove:v.onTouchMove,onTouchend:v.onTouchEnd,onTouchcancel:v.onTouchEnd},{default:l((()=>[u.$slots.default||u.$slots.$default?i(u.$slots,"default",{key:0},void 0,!0):(e(),t(m,{key:1,class:"u-slider__button",style:a([n.blockStyle,{height:n.blockWidth+"rpx",width:n.blockWidth+"rpx",backgroundColor:n.blockColor}])},null,8,["style"]))])),_:3},8,["onTouchstart","onTouchmove","onTouchend","onTouchcancel"])])),_:3},8,["style"])])),_:3},8,["onClick","class","style"])}],["__scopeId","data-v-589449ae"]]),G=X(u({__name:"video-player",props:{src:null,cover:null,duration:null,title:null,canDrag:{type:Boolean},modelValue:null},emits:["update:modelValue"],setup(i,{emit:o}){const u=i;d((e=>({b35f9224:n(T)})));const S=c(),V=h(0),T=h(1),I=h(!0),F=h(null);let $;const B=h(0),D=h(!1),j=h(0);v((()=>{F.value=m("video",p()),M()}));const M=()=>{var e,t;j.value=0,V.value=0,B.value=0,W(),I.value=!1,u.modelValue&&(j.value=u.modelValue,B.value=u.modelValue,null==(e=F.value)||e.seek(u.modelValue),null==(t=F.value)||t.play())},W=e=>{if(T.value=1,$&&!e)return clearTimeout($),T.value=0,void($=null);$&&clearTimeout($),$=setTimeout((()=>{T.value=0,$=null}),5e3)},N=e=>{W(!0),"progress"==e.target.id&&L()},R=()=>{W(!0),I.value=!I.value},X=e=>{B.value=e.detail.currentTime,V.value=e.detail.currentTime/u.duration*100,B.value>j.value&&(j.value=B.value,o("update:modelValue",B.value))},L=()=>{var e,t;W(!0);const l=u.duration*V.value/100;l>j.value&&!u.canDrag?(S.showToast({title:"请勿向后拖拽视频",type:"warning",position:"top"}),null==(e=F.value)||e.seek(j.value)):null==(t=F.value)||t.seek(l)};return f(I,(e=>{var t,l;e?null==(l=F.value)||l.pause():null==(t=F.value)||t.play()})),f(D,(e=>{var t,l;e?null==(l=F.value)||l.exitFullScreen():null==(t=F.value)||t.requestFullScreen()})),f((()=>u.src),(e=>{I.value=!0,setTimeout((()=>M()),500)})),(i,o)=>{const d=g(y("u-slider"),A),c=_,h=r,v=g(y("u-icon"),z),m=k,p=P;return e(),t(p,{class:"video","object-fit":"contain",controls:!1,"show-center-play-btn":!1,src:u.src,cover:u.cover,id:"video",title:u.title,onTimeupdate:X,onError:o[5]||(o[5]=e=>n(S).showTips({title:"视频加载出错",type:"error"}))},{default:l((()=>[s(h,{class:"video_container",onClick:o[4]||(o[4]=()=>W())},{default:l((()=>[s(h,{class:"video_controls",onClick:b(N,["stop"]),style:a({visibility:n(T)?"visible":"hidden"})},{default:l((()=>[s(d,{id:"progress",type:"warning","active-color":"#FF6905","block-color":"#FF6905",modelValue:n(V),"onUpdate:modelValue":o[0]||(o[0]=e=>w(V)?V.value=e:null),min:0,max:100,step:.01,onStart:o[1]||(o[1]=e=>I.value=!0),onMoving:L,onEnd:o[2]||(o[2]=e=>I.value=!1)},null,8,["modelValue","step"]),s(h,{class:"text-white flex justify-between relative bottom--30"},{default:l((()=>[s(c,null,{default:l((()=>[C(x(n(E).unix(n(B)).format("mm:ss")),1)])),_:1}),s(c,null,{default:l((()=>[C(x(n(E).unix(u.duration).format("mm:ss")),1)])),_:1})])),_:1}),s(v,{onClick:o[3]||(o[3]=e=>D.value=!n(D)),class:"ml-auto relative top--60",size:"40",name:"/static/icon/common/full-screen.svg"})])),_:1},8,["onClick","style"]),s(h,{class:"video_center_btn",onClick:b(R,["stop"]),style:a({visibility:n(T)?"visible":"hidden"})},{default:l((()=>[n(I)?(e(),t(m,{key:1,class:"w-1-sl-3 h-1-sl-3 v-else",src:"/static/icon/common/play.svg",mode:"widthFix"})):(e(),t(m,{key:0,class:"w-1-sl-4 h-1-sl-4",src:"/static/icon/common/pause.svg",mode:"widthFix"}))])),_:1},8,["onClick","style"])])),_:1})])),_:1},8,["src","cover","title"])}}}),[["__scopeId","data-v-abcba777"]]);const J=X({name:"u-circle-progress",props:{percent:{type:Number,default:0,validator:e=>e>=0&&e<=100},inactiveColor:{type:String,default:"#ececec"},activeColor:{type:String,default:"#19be6b"},borderWidth:{type:[Number,String],default:14},width:{type:[Number,String],default:200},duration:{type:[Number,String],default:1500},type:{type:String,default:""},bgColor:{type:String,default:"#ffffff"}},data(){return{elBgId:this.$u.guid(),elId:this.$u.guid(),widthPx:S(this.width),borderWidthPx:S(this.borderWidth),startAngle:-Math.PI/2,progressContext:null,newPercent:0,oldPercent:0}},watch:{percent(e,t=0){e>100&&(e=100),e<0&&(t=0),this.newPercent=e,this.oldPercent=t,setTimeout((()=>{this.drawCircleByProgress(t)}),50)}},created(){this.newPercent=this.percent,this.oldPercent=0},computed:{circleColor(){return["success","error","info","primary","warning"].indexOf(this.type)>=0?this.$u.color[this.type]:this.activeColor}},mounted(){setTimeout((()=>{this.drawProgressBg(),this.drawCircleByProgress(this.oldPercent)}),50)},methods:{drawProgressBg(){let e=V(this.elBgId,this);e.setLineWidth(this.borderWidthPx),e.setStrokeStyle(this.inactiveColor),e.beginPath();let t=this.widthPx/2;e.arc(t,t,t-this.borderWidthPx,0,2*Math.PI,!1),e.stroke(),e.draw()},drawCircleByProgress(e){let t=this.progressContext;t||(t=V(this.elId,this),this.progressContext=t),t.setLineCap("round"),t.setLineWidth(this.borderWidthPx),t.setStrokeStyle(this.circleColor);let l=Math.floor(this.duration/100),s=2*Math.PI/100*e+this.startAngle;t.beginPath();let a=this.widthPx/2;if(t.arc(a,a,a-this.borderWidthPx,this.startAngle,s,!1),t.stroke(),t.draw(),this.newPercent>this.oldPercent){if(++e>this.newPercent)return}else if(--e<this.newPercent)return;setTimeout((()=>{this.drawCircleByProgress(e)}),l)}}},[["render",function(o,u,d,n,c,h){const v=I,m=r;return e(),t(m,{class:"u-circle-progress",style:a({width:c.widthPx+"px",height:c.widthPx+"px",backgroundColor:d.bgColor})},{default:l((()=>[T(" 支付宝小程序不支持canvas-id属性，必须用id属性 "),s(v,{class:"u-canvas-bg","canvas-id":c.elBgId,id:c.elBgId,style:a({width:c.widthPx+"px",height:c.widthPx+"px"})},null,8,["canvas-id","id","style"]),s(v,{class:"u-canvas","canvas-id":c.elId,id:c.elId,style:a({width:c.widthPx+"px",height:c.widthPx+"px"})},null,8,["canvas-id","id","style"]),i(o.$slots,"default",{},void 0,!0)])),_:3},8,["style"])}],["__scopeId","data-v-97b6389c"]]),O=X(u({__name:"detail",setup(a){const i=h(""),o=h(-1);h(-1);const u=h({}),d=h([]);let c=0;return f((()=>u.value.watchedVideoDuration),((e,t)=>{if(!e)return;if(!u.value.videoDuration)return;d.value[o.value].progress=e/u.value.videoDuration;const l=Math.floor(e/10);if(u.value.videoCode){if(d.value[o.value].progress>=1)return q({partyClassCode:i.value,videoCodeSign:u.value.videoCode}),console.log("update"),void W("updateList",d.value);l==c&&d.value[o.value].progress<=1?(q({partyClassCode:i.value,videoCodeSign:u.value.videoCode}),console.log("update")):1==d.value[o.value].progress&&console.log("update2"),c=Math.floor(e/10)+1}})),F((async e=>{e&&e.videoCode&&e.classCode&&(u.value=await U({classCode:e.classCode,videoCode:e.videoCode}),i.value=e.classCode,d.value=$().globalData.videoList,o.value=d.value.findIndex((t=>t.code==e.videoCode)))})),(a,h)=>{const v=g(y("u-navbar"),N),m=g(y("message"),R),p=g(y("video-player"),G),f=g(y("u-section"),L),b=r,w=_,P=g(y("u-icon"),z),S=k,V=g(y("u-circle-progress"),J);return e(),B(D,null,[s(v,{class:"absolute",background:{backgroundColor:"transparent"},"border-bottom":!1}),s(m),s(b,{class:"container h-full",style:{"background-color":"rgba(31, 31, 57, 0.45)"}},{default:l((()=>[s(p,{class:"w-full flex items-end",src:n(u).videoUrl&&n(M).ResourceUrl+n(u).videoUrl,duration:n(u).videoDuration,title:n(u).title,modelValue:n(u).watchedVideoDuration,"onUpdate:modelValue":h[0]||(h[0]=e=>n(u).watchedVideoDuration=e)},null,8,["src","duration","title","modelValue"]),s(b,{class:"p-5 z-10 bg-white rounded-t-3xl h-full"},{default:l((()=>[s(b,{class:"flex flex-col gap-3 h-full"},{default:l((()=>[s(f,{title:n(u).name,"sub-title":`已经获学时：${n(u).getClassHour}`,arrow:!1,"show-line":!1,"font-size":"32","sub-color":"#FD0000"},null,8,["title","sub-title"]),s(b,{class:"indent-sm",style:{color:"#858597","font-size":"20rpx"}},{default:l((()=>[C(x(n(u).partyCommittee),1)])),_:1}),-1!=n(o)?(e(),t(b,{key:0},{default:l((()=>[C(x(n(u).title),1)])),_:1})):T("v-if",!0),s(b,{class:"indent-sm",style:{color:"#858597","font-size":"20rpx"}},{default:l((()=>[C(x(n(u).description),1)])),_:1}),T(" 列表 "),s(b,{class:"flex flex-col gap-3 mt-auto"},{default:l((()=>[(e(!0),B(D,null,j(n(d),((a,r)=>(e(),t(b,{class:"flex gap-3 items-center",key:r},{default:l((()=>[s(b,{style:{color:"#b8b8d2","font-size":"50rpx"}},{default:l((()=>[C(x((r+1).toString().padStart(2,"0")),1)])),_:2},1024),s(b,null,{default:l((()=>[s(b,{style:{color:"#1f1f39","font-size":"30rpx"}},{default:l((()=>[C(x(a.title),1)])),_:2},1024),s(b,{style:{color:"#ff6905","font-size":"20rpx"}},{default:l((()=>[s(w,{class:"align-middle"},{default:l((()=>[C(x(a.videoDuration)+"s",1)])),_:2},1024),a.progress>=1?(e(),t(P,{key:0,class:"ml-2 align-middle",size:"30",name:"/static/icon/common/success.svg"})):T("v-if",!0)])),_:2},1024)])),_:2},1024),n(o)!=r?(e(),t(b,{key:0,class:"btn flex",onClick:e=>(async(e,t)=>{u.value.videoUrl="",u.value.watchedVideoDuration=0,u.value=await U({classCode:i.value,videoCode:e}),o.value=t,c=0})(a.code,r)},{default:l((()=>[s(S,{class:"w-1-sl-3 h-1-sl-3 m-auto",src:"/static/icon/common/play.svg",mode:"widthFix"})])),_:2},1032,["onClick"])):n(o)==r?(e(),t(V,{key:1,width:"90",class:"ml-auto","active-color":"#FF6905","border-width":"2",percent:100*a.progress},{default:l((()=>[s(b,{style:{"background-color":"#3d5cff"},class:"w-full h-full rounded-1-sl-2 flex"},{default:l((()=>[s(S,{class:"w-1-sl-4 h-1-sl-4 m-auto",src:"/static/icon/common/pause.svg",mode:"widthFix"})])),_:1})])),_:2},1032,["percent"])):T("v-if",!0),T(' <view v-else-if="current == index" style="background-color: #3d5cff" class="btn flex">\r\n              <image\r\n                class="w-1-sl-4 h-1-sl-4 m-auto"\r\n                src="/static/icon/common/pause.svg"\r\n                mode="widthFix"\r\n              />\r\n            </view> ')])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-7b058238"]]);export{O as default};
