import{k as a,T as s,L as e,m as r,q as t,o,b as l,a as u,w as i,x as n,f as p,F as m,D as d,Z as c,H as f,B as _,C as g,h as v}from"./index.f8f0a8a6.js";import{_ as b}from"./u-navbar.1284843c.js";import{_ as h}from"./message.vue_vue_type_script_setup_true_lang.2049d432.js";import{_ as j}from"./u-upload.bcce9b3d.js";import{_ as y,a as w}from"./u-cell-group.c1b9a19e.js";import{_ as z}from"./u-button.9b5620aa.js";import{s as U}from"./develop.a9e15139.js";import{d as x}from"./dayjs.min.4485b413.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./u-line-progress.aa9a4d7b.js";const T=a({__name:"zs-upload",setup(a){const T=s(),k=e(),A=[],O=r(null),R=r(""),Y=r([]),D=r(!1);t((a=>{a&&a.zsAddress&&(Y.value=JSON.parse(a.zsAddress)),a&&a.username&&(R.value=a.username)}));const C=(a,s,e)=>{const{data:{imageUrl:r}}=a;A.push(r)},H=(a,s,e)=>{const r=s.filter((a=>100==a.progress));Y.value=r.map((a=>a.url.slice(d.ResourceUrl.length)))},M=async()=>{try{D.value=!0;const a=[...Y.value,...A];if(!a||!a.length)throw k.showTips({title:"提交内容不能为空",type:"error"}),Error("提交内容不能为空");await U({isPass:!0,username:R.value,zsAddress:a,zspassTime:x().format("YYYY-MM-DD")}),k.showTips({title:"上传成功",type:"success"}),c("refresh"),setTimeout((()=>f()),500)}catch(a){D.value=!1}};return(a,s)=>{const e=_(g("u-navbar"),b),r=_(g("message"),h),t=_(g("u-upload"),j),c=_(g("u-cell-item"),y),f=_(g("u-cell-group"),w),U=_(g("u-button"),z),x=v;return o(),l(m,null,[u(e,{title:"上传政审表"}),u(r,{navbarHeight:48}),u(x,{class:"container"},{default:i((()=>[u(f,null,{default:i((()=>[u(c,{title:"上传政审表",arrow:!1},{label:i((()=>[u(t,{ref_key:"uploadRef",ref:O,name:"image",action:n(d).UploadImgUrl,"auto-upload":!1,header:{Authorization:n(T).token},"file-list":n(Y).map((a=>({url:n(d).ResourceUrl+a}))),onOnSuccess:C,onOnRemove:H,onOnUploaded:M},null,8,["action","header","file-list"])])),_:1})])),_:1}),u(x,{class:"fixed bottom-0 w-full"},{default:i((()=>[u(U,{loading:n(D),type:"primary",onClick:s[0]||(s[0]=a=>n(O).upload())},{default:i((()=>[p("上传")])),_:1},8,["loading"])])),_:1})])),_:1})],64)}}});export{T as default};
