import{k as e,L as l,am as a,m as o,q as t,an as r,D as u,o as s,b as d,a as m,w as n,x as i,Y as p,y as c,t as f,f as v,F as _,B as b,C as y,h as g,Z as V}from"./index.7dddb93e.js";import{_ as h}from"./u-navbar.2247389e.js";import{_ as j}from"./message.vue_vue_type_script_setup_true_lang.167ae55e.js";import{_ as x}from"./u-input.4a92a7e0.js";import{_ as C,a as k}from"./u-form.2758243d.js";import{_ as w,a as U}from"./u-cell-group.3ff6fc80.js";import{_ as T}from"./u-picker.e822a654.js";import{_ as A}from"./u-button.7f757efe.js";import{_ as N,d as B}from"./useDebounce.1587bee8.js";import{p as P}from"./index.14235ccc.js";import{g as L}from"./go.59004091.js";import{e as O,b as z}from"./papper.9f210250.js";import{_ as W}from"./_plugin-vue_export-helper.cdc0426e.js";import"./emitter.9c2dba95.js";import"./u-upload.fc59abfe.js";import"./u-line-progress.c40d9c0e.js";const D=W(e({__name:"edit",setup(e){const W=l(),D=a(),F=o(!1),I=o(!1),R=o(!1),S=o(!1),q=o(""),E=o("");let H=o([]);const Y=o([]);let Z=o({code:"",paperName:"",PaperTime:"",mainWriter:"",level:"",journalName:"",partyCommitteeCode:"",partyBranchCode:"",fileAddress:[]});t((async e=>{if(e&&e.code){let l=await O({code:e.code});Z.value.PaperTime=l.paperTime,q.value=l.partyCommitteeName,E.value=l.partyBranchName,Object.keys(l).filter((e=>Object.keys(Z.value).includes(e))).reduce(((e,a)=>(e[a]=l[a],e)),Z.value);let a=await r({code:l.partyCommitteeCode});Y.value=a}Z.value.fileAddress.forEach((e=>{H.value.push({url:u.ResourceUrl+e.url})}))}));const G=e=>{Z.value.fileAddress.push({name:e.split("/")[1],url:e})},J=e=>{Z.value.PaperTime=e.year+"-"+e.month+"-"+e.day},K=async e=>{q.value=D.committeeList[e[0]].name,Z.value.partyCommitteeCode=D.committeeList[e[0]].code,E.value="";let l=await r({code:D.committeeList[e[0]].code});Y.value=l},M=e=>{E.value=Y.value[e[0]].name,Z.value.partyBranchCode=Y.value[e[0]].code},Q=e=>{Z.value.fileAddress.splice(e,1)},X=e=>{Z.value.level=P[e[0]].value},$=B((async()=>{let e=ee(Z.value);console.log(e);for(const[a,o]of Object.entries(Z.value))if("partyBranchCode"!==a&&"code"!==a&&"fileAddress"!==a){if(e){await z(Z.value);try{W.showTips({title:"修改成功",type:"success"}),setTimeout((()=>{L("/pages/honour-manage/papper/papper"),V("addPapperSuccess")}),1e3)}catch(l){}break}W.showTips({title:"请将内容填写完整",type:"warning"});break}}),1e3),ee=e=>{for(const[l,a]of Object.entries(e))if("partyBranchCode"!==l&&"code"!==l&&"fileAddress"!==l&&(""===a||Array.isArray(a)&&0===a.length||void 0===a))return!1;return!0};return(e,l)=>{const a=b(y("u-navbar"),h),o=b(y("message"),j),t=b(y("u-input"),x),r=b(y("u-form-item"),C),u=b(y("u-form"),k),V=g,B=b(y("u-cell-item"),w),L=b(y("u-cell-group"),U),O=b(y("u-picker"),T),z=b(y("u-button"),A);return s(),d(_,null,[m(a,{"title-color":"#000","is-back":!0,title:"修改论文",background:{background:"#ffffff"},"border-bottom":!1}),m(o,{navbarHeight:48}),m(V,{class:"container pb-20rpx"},{default:n((()=>[m(u,{clas:"p-4px",model:i(Z),"label-width":"200",ref:"uForm","label-align":"center"},{default:n((()=>[m(r,{label:"论文名称"},{default:n((()=>[m(t,{modelValue:i(Z).paperName,"onUpdate:modelValue":l[0]||(l[0]=e=>i(Z).paperName=e),placeholder:"请输入荣誉名称"},null,8,["modelValue"])])),_:1}),m(r,{label:"第一作者"},{default:n((()=>[m(t,{modelValue:i(Z).mainWriter,"onUpdate:modelValue":l[1]||(l[1]=e=>i(Z).mainWriter=e),placeholder:"请输入获奖对象"},null,8,["modelValue"])])),_:1}),m(r,{label:"期刊名称"},{default:n((()=>[m(t,{modelValue:i(Z).journalName,"onUpdate:modelValue":l[2]||(l[2]=e=>i(Z).journalName=e),placeholder:"请输入颁奖单位"},null,8,["modelValue"])])),_:1}),m(r,{label:"二级党委"},{default:n((()=>[m(t,{placeholder:"请选择二级党委",disabled:!0,onClick:l[3]||(l[3]=e=>I.value=!0),modelValue:i(q),"onUpdate:modelValue":l[4]||(l[4]=e=>p(q)?q.value=e:null)},null,8,["modelValue"])])),_:1}),m(r,{label:"党支部"},{default:n((()=>[m(t,{placeholder:"请选择党支部",disabled:!0,onClick:l[5]||(l[5]=e=>S.value=!0),modelValue:i(E),"onUpdate:modelValue":l[6]||(l[6]=e=>p(E)?E.value=e:null)},null,8,["modelValue"])])),_:1}),m(r,{label:"论文级别"},{default:n((()=>[m(t,{placeholder:"请选择论文级别",disabled:!0,onClick:l[7]||(l[7]=e=>R.value=!0),modelValue:i(Z).level,"onUpdate:modelValue":l[8]||(l[8]=e=>i(Z).level=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),m(L,null,{default:n((()=>[m(B,{arrow:!1},{default:n((()=>[m(V,{slot:"icon",class:"flex items-center"},{default:n((()=>[c("span",null,"发表日期"),m(V,{class:"flex flex-col items-center justify-center my-20rpx"},{default:n((()=>[m(V,{class:"w-350rpx h-50rpx m-20rpx rounded-lg bg--wn-f5f5f5 leading-50rpx text-center mx-20rpx",onClick:l[9]||(l[9]=e=>F.value=!0)},{default:n((()=>[""==i(Z).PaperTime?(s(),d("span",{key:0}," 发表日期 ")):(s(),d("span",{key:1,class:"v-else"},f(i(Z).PaperTime),1))])),_:1})])),_:1})])),_:1})])),_:1}),m(B,{arrow:!1},{default:n((()=>[m(V,{slot:"icon",class:"flex items-center"},{default:n((()=>[m(V,{class:"justify-center w-full"},{default:n((()=>[m(V,{class:"w-224rpx"},{default:n((()=>[v(" 支撑材料上传 ")])),_:1}),m(V,{class:"w-700rpx"},{default:n((()=>[m(N,{"file-list":i(H),onUploadSuccess:G,onImgRemove:Q},null,8,["file-list"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),m(O,{modelValue:i(F),"onUpdate:modelValue":l[10]||(l[10]=e=>p(F)?F.value=e:null),mode:"time",params:{year:!0,month:!0,day:!0},onConfirm:J},null,8,["modelValue"]),m(O,{mode:"selector",modelValue:i(R),"onUpdate:modelValue":l[11]||(l[11]=e=>p(R)?R.value=e:null),range:i(P),"z-index":"99999999999999",title:"请选择论文级别","default-selector":[0],"range-key":"value",onConfirm:X},null,8,["modelValue","range"]),m(O,{mode:"selector",modelValue:i(I),"onUpdate:modelValue":l[12]||(l[12]=e=>p(I)?I.value=e:null),range:i(D).committeeList,"z-index":"99999999999999",title:"请选择二级党委","default-selector":[0],"range-key":"name",onConfirm:K},null,8,["modelValue","range"]),m(O,{mode:"selector",modelValue:i(S),"onUpdate:modelValue":l[13]||(l[13]=e=>p(S)?S.value=e:null),range:i(Y),"z-index":"99999999999999",title:"请选择党支部","default-selector":[0],"range-key":"name",onConfirm:M},null,8,["modelValue","range"]),m(V,{class:"flex items-center justify-around w-full h-300rpx"},{default:n((()=>[m(z,{class:"w-95-pes-",type:"primary",ripple:!0,onClick:l[14]||(l[14]=e=>i($)())},{default:n((()=>[v("提交")])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-b66e6eee"]]);export{D as default};
