import{k as e,m as a,M as t,a5 as o,q as l,B as r,C as s,o as n,c as i,w as u,I as p,x as c,a as d,K as g}from"./index.7dddb93e.js";import{_ as m}from"./u-loadmore.c9a600cb.js";const f=e({__name:"pagination",props:{api:null,afterFetch:null,params:null,option:null},setup(e,{expose:f}){const v=e,h=a("loading"),S=a([]),z=t({pageSize:10,pageNum:1,totalSize:null}),w=a(),y=a(),N=async()=>{y.value||(y.value=!0,await F(),setTimeout((()=>{w.value=!1,y.value=!1}),500))},b=()=>{w.value="restore",console.log("onRestore")};o((()=>v.api),((e,a)=>{F()})),o((()=>({...v.params})),((e,a)=>{if(!e||!a)return;let t=!0;for(const o in e)if((void 0!==e[o]&&null!==e[o]&&""!==e[o]||void 0!==a[o]&&null!==a[o]&&""!==a[o])&&e[o]!=a[o]){t=!1;break}t||F()}),{deep:!0,immediate:!0});const x=async()=>{var e;try{h.value="loading";const a=v.params||{};for(const e in a){const t=a[e];null!=t&&""!==t||delete a[e]}if(!v.api)return;let t=await v.api({pageNum:z.pageNum,pageSize:z.pageSize,...a});v.afterFetch&&(t=await v.afterFetch.call(null,t));const o=v.option&&v.option.resultField||"data";return z.totalSize=t[v.option&&(null==(e=v.option)?void 0:e.totalSize)||"totalSize"],setTimeout((()=>{null!=z.totalSize&&z.pageSize*z.pageNum>=z.totalSize?h.value="nomore":h.value="loadmore"}),500),z.pageNum++,t[o]}catch(a){h.value="nomore"}},_=async()=>{if("nomore"==h.value||"loading"==h.value)return;const e=await x();S.value=S.value.concat(e)},F=async()=>{z.pageNum=1,S.value=[];const e=await x();S.value=e};return l((async()=>{v.option&&v.option.pageSize&&(z.pageSize=v.option.pageSize);const e=await x();S.value=e})),f({reload:F,data:S,pagination:z}),(e,a)=>{const t=r(s("u-loadmore"),m),o=g;return n(),i(o,{"scroll-y":"",style:{height:"100%",width:"100%"},onScrolltolower:_,"refresher-enabled":"","refresher-triggered":c(w),onRefresherrefresh:N,onRefresherrestore:b,class:"scroll-y refresher-enabled"},{default:u((()=>[p(e.$slots,"default",{data:c(S)}),d(t,{class:"leading-80rpx",status:c(h)},null,8,["status"])])),_:3},8,["refresher-triggered"])}}});export{f as _};
