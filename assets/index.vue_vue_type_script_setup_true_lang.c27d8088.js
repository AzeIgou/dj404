import{G as t,a8 as e,o as s,c as i,w as a,a as l,n as o,e as n,I as h,b as u,F as c,r as d,f as r,t as p,g as m,h as f,ao as v,ap as b,k as w,L as _,D as y,m as g,q as x,T as k,x as C,Y as W,aj as X,B,C as F,aq as T,J as $,a6 as S,a7 as A}from"./index.f8f0a8a6.js";import{_ as E,d as U}from"./message.vue_vue_type_script_setup_true_lang.2049d432.js";import{_ as V}from"./_plugin-vue_export-helper.cdc0426e.js";const j=V({name:"u-swipe-action",emits:["click","content-click","open","close"],props:{index:{type:[Number,String],default:""},btnWidth:{type:[String,Number],default:180},disabled:{type:Boolean,default:!1},show:{type:Boolean,default:!1},bgColor:{type:String,default:"#ffffff"},vibrateShort:{type:Boolean,default:!1},options:{type:Array,default:()=>[]}},watch:{show:{immediate:!0,handler(t,e){t?this.open():this.close()}}},data(){return{moveX:0,scrollX:0,status:!1,movableAreaWidth:0,elId:this.$u.guid(),showBtn:!1}},computed:{movableViewWidth(){return this.movableAreaWidth+this.allBtnWidth+"px"},innerBtnWidth(){return t(this.btnWidth)},allBtnWidth(){return t(this.btnWidth)*this.options.length},btnStyle(){return t=>(t.width=this.btnWidth+"rpx",t)}},mounted(){this.getActionRect()},methods:{btnClick(t){this.status=!1,this.$emit("click",this.index,t)},change(t){this.scrollX=t.detail.x},close(){this.moveX=0,this.status=!1},open(){this.disabled||(this.moveX=-this.allBtnWidth,this.status=!0)},touchend(){this.moveX=this.scrollX,this.$nextTick((function(){0==this.status?this.scrollX<=-this.allBtnWidth/4?(this.moveX=-this.allBtnWidth,this.status=!0,this.emitOpenEvent(),this.vibrateShort&&e()):(this.moveX=0,this.status=!1,this.emitCloseEvent()):this.scrollX>3*-this.allBtnWidth/4?(this.moveX=0,this.$nextTick((()=>{this.moveX=101})),this.status=!1,this.emitCloseEvent()):(this.moveX=-this.allBtnWidth,this.status=!0,this.emitOpenEvent())}))},emitOpenEvent(){this.$emit("open",this.index)},emitCloseEvent(){this.$emit("close",this.index)},touchstart(){},getActionRect(){this.$uGetRect(".u-swipe-action").then((t=>{this.movableAreaWidth=t.width,this.$nextTick((()=>{this.showBtn=!0}))}))},contentClick(){1==this.status&&(this.status="close",this.moveX=0),this.$emit("content-click",this.index)}}},[["render",function(t,e,w,_,y,g){const x=f,k=v,C=b;return s(),i(x,{class:""},{default:a((()=>[l(C,{class:"u-swipe-action",style:o({backgroundColor:w.bgColor})},{default:a((()=>[l(k,{class:"u-swipe-view",onChange:g.change,onTouchend:g.touchend,onTouchstart:g.touchstart,direction:"horizontal",disabled:w.disabled,x:y.moveX,style:o({width:g.movableViewWidth?g.movableViewWidth:"100%"})},{default:a((()=>[l(x,{class:"u-swipe-content",onClick:n(g.contentClick,["stop"])},{default:a((()=>[h(t.$slots,"default",{},void 0,!0)])),_:3},8,["onClick"]),y.showBtn?(s(!0),u(c,{key:0},d(w.options,((t,e)=>(s(),i(x,{class:"u-swipe-del",onClick:n((t=>g.btnClick(e)),["stop"]),style:o([g.btnStyle(t.style)]),key:e},{default:a((()=>[l(x,{class:"u-btn-text"},{default:a((()=>[r(p(t.text),1)])),_:2},1024)])),_:2},1032,["onClick","style"])))),128)):m("v-if",!0)])),_:3},8,["onChange","onTouchend","onTouchstart","disabled","x","style"])])),_:3},8,["style"])])),_:3})}],["__scopeId","data-v-84de1e5c"]]),R=w({__name:"index",props:{propsList:null},emits:["fileUploadFinsh","removeFile"],setup(t,{expose:e,emit:o}){const h=t,v=_();let b=[{text:"预览",style:{backgroundColor:"#007aff"}},{text:"删除",style:{backgroundColor:"#dd524d"}}],w=y.fileuploadUrl,V=g([]);x((async()=>{h.propsList&&setTimeout((()=>{h.propsList.forEach((t=>{V.value.push(t)}))}),500)}));let R=g(!1),L=g("");const O=k().token;e({uploadFile:()=>{uni.chooseMessageFile({count:6,type:"file",success:function(t){let e=t.tempFiles[0].name;"pdf"==t.tempFiles[0].name.split(".").pop()||"mp4"==t.tempFiles[0].name.split(".").pop()?X({url:w,header:{Authorization:O},filePath:t.tempFiles[0].path,name:"file",success:t=>{const s=JSON.parse(t.data).data.fileUrl;V.value.push({name:e,url:y.ResourceUrl+s,show:!1}),o("fileUploadFinsh",{name:e,url:s})}}):v.showTips({title:"请上传pdf或mp4类型的文件",type:"warning"})}})}});const I=(t,e)=>{var s;0==e?"mp4"==(s=V.value[t]).name.split(".").pop()?(R.value=!0,L.value=s.url):(console.log("fasle"),S({url:y.ResourceUrl+s.url,success:function(t){var e=t.tempFilePath;A({filePath:e,success:function(t){console.log("打开文档成功")}})}})):(console.log(V.value[t]),o("removeFile",V.value[t]),V.value.splice(t,1))};return(t,e)=>{const o=B(F("message"),E),h=$,v=f,w=B(F("u-swipe-action"),j),_=T,y=B(F("u-modal"),U);return s(),i(v,null,{default:a((()=>[l(o,{navbarHeight:48}),l(v,null,{default:a((()=>[(s(!0),u(c,null,d(C(V),((t,e)=>(s(),i(w,{show:t.show,index:e,key:e,onClick:n(I,["stop"]),options:C(b)},{default:a((()=>[l(v,{class:"p-20px u-border-bottom"},{default:a((()=>[m(" 此层wrap在此为必写的，否则可能会出现标题定位错误 "),l(v,{class:"title-wrap"},{default:a((()=>[l(h,{class:"title u-line-2"},{default:a((()=>[r(p(t.name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["show","index","onClick","options"])))),128))])),_:1}),l(y,{modelValue:C(R),"onUpdate:modelValue":e[0]||(e[0]=t=>W(R)?R.value=t:R=t),"show-title":!1,"mask-close-able":!0,"show-confirm-button":!1},{default:a((()=>[l(v,{class:"slot-content flex justify-center items-center"},{default:a((()=>[l(_,{src:C(L),autoplay:!0},null,8,["src"])])),_:1})])),_:1},8,["modelValue"])])),_:1})}}});export{R as _};
